<Window x:Class="IntellectFlow.Views.StudentSubmissionsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:IntellectFlow.Helpers"
        xmlns:data="clr-namespace:IntellectFlow.DataModel"
        Title="Задания студента" Height="600" Width="1000"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <local:NullToBooleanConverter x:Key="NullToFalseConverter" />

        <!-- Стиль для кнопок действий -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF0078D7"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8 4"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF0066B3"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#FF005499"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="LightGray"/>
                    <Setter Property="Foreground" Value="DarkGray"/>
                    <Setter Property="Opacity" Value="0.7"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="7*" />
        </Grid.ColumnDefinitions>

        <!-- Левая часть: Комментарии и кнопка -->
        <StackPanel Grid.Column="0" Margin="0,0,10,0">
            <GroupBox Header="Детали решения">
                <StackPanel Margin="10">
                    <TextBlock Text="Комментарий преподавателя:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding SelectedAssignment.TeacherComment, UpdateSourceTrigger=PropertyChanged}" 
                             TextWrapping="Wrap" 
                             Height="60"
                             AcceptsReturn="True"/>

                    <TextBlock Text="Комментарий ИИ:" FontWeight="Bold" Margin="0,10,0,5"/>
                    <TextBox Text="{Binding SelectedAssignment.AiComment, Mode=OneWay}" 
                             IsReadOnly="True" 
                             TextWrapping="Wrap" 
                             Height="60"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <TextBlock Text="Оценка ИИ:" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SelectedAssignment.AiScore}" 
                                   Margin="10,0" 
                                   FontSize="16"
                                   MinWidth="30"
                                   HorizontalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedAssignment.AiScore}" Value="1">
                                            <Setter Property="Foreground" Value="Red"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedAssignment.AiScore}" Value="2">
                                            <Setter Property="Foreground" Value="OrangeRed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedAssignment.AiScore}" Value="3">
                                            <Setter Property="Foreground" Value="Orange"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedAssignment.AiScore}" Value="4">
                                            <Setter Property="Foreground" Value="Green"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedAssignment.AiScore}" Value="5">
                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <Button Content="Сохранить изменения"
                    Command="{Binding SaveChangesCommand}"
                    Style="{StaticResource ActionButtonStyle}"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0"
                    MinWidth="120"/>
        </StackPanel>

        <!-- Правая часть: Таблица -->
        <ListView Grid.Column="1"
                  ItemsSource="{Binding StudentAssignments}" 
                  SelectedItem="{Binding SelectedAssignment}"
                  ScrollViewer.VerticalScrollBarVisibility="Auto">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Задание" Width="250" 
                                    DisplayMemberBinding="{Binding Assignment.Title}" />

                    <GridViewColumn Header="Статус" Width="120">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding DisplayStatus}" Margin="4">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="Gray" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Submission.Status}" 
                                                             Value="{x:Static data:SubmissionStatus.Checked}">
                                                    <Setter Property="Foreground" Value="Green" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Submission.Status}" 
                                                             Value="{x:Static data:SubmissionStatus.Rejected}">
                                                    <Setter Property="Foreground" Value="Red" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Submission.Status}" 
                                                             Value="{x:Static data:SubmissionStatus.Pending}">
                                                    <Setter Property="Foreground" Value="Orange" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Submission.Status}" 
                                                             Value="{x:Static data:SubmissionStatus.Submitted}">
                                                    <Setter Property="Foreground" Value="#0078D7" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Оценка" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding TeacherScore, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="40"
                                         HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Комментарий" Width="200">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding TeacherComment, UpdateSourceTrigger=PropertyChanged}" 
                                         TextWrapping="Wrap" 
                                         AcceptsReturn="True"
                                         Height="60"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Файл" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Открыть"
                                        Command="{Binding DataContext.OpenSubmissionFileCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                        IsEnabled="{Binding SubmissionFilePath, Converter={StaticResource NullToFalseConverter}}"
                                        ToolTip="Открыть файл студента"
                                        Style="{StaticResource ActionButtonStyle}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="AI Оценка" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding AiScore}" 
                                           HorizontalAlignment="Center"
                                           FontWeight="Bold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="Black"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding AiScore}" Value="1">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AiScore}" Value="2">
                                                    <Setter Property="Foreground" Value="OrangeRed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AiScore}" Value="3">
                                                    <Setter Property="Foreground" Value="Orange"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AiScore}" Value="4">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AiScore}" Value="5">
                                                    <Setter Property="Foreground" Value="DarkGreen"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="AI Комментарий" Width="200">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding AiComment}" 
                                         IsReadOnly="True" 
                                         TextWrapping="Wrap" 
                                         Height="60"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Действия" Width="120">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Проверить ИИ"
        Command="{Binding CheckWithAICommand}"
        ToolTip="Отправить на проверку ИИ">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding HasSubmissionContent}" Value="False">
                                                    <Setter Property="ToolTip" Value="Нет решения для проверки"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>
    </Grid>
</Window>